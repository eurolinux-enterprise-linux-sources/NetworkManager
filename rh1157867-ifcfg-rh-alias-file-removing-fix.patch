From 22d842eede2e38f48eedb45452167adacbacbb5c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ji=C5=99=C3=AD=20Klime=C5=A1?= <jklimes@redhat.com>
Date: Wed, 8 Apr 2015 10:03:11 +0200
Subject: [PATCH] ifcfg-rh: don't remove base connection if an alias file is
 removed (rh #1157867)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

but rather signal the base file change.

https://bugzilla.redhat.com/show_bug.cgi?id=1157867
Signed-off-by: Jiří Klimeš <jklimes@redhat.com>
---
 system-settings/plugins/ifcfg-rh/plugin.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/system-settings/plugins/ifcfg-rh/plugin.c b/system-settings/plugins/ifcfg-rh/plugin.c
index 1c52b06..5a5d03c 100644
--- a/system-settings/plugins/ifcfg-rh/plugin.c
+++ b/system-settings/plugins/ifcfg-rh/plugin.c
@@ -335,6 +335,9 @@ dir_changed (GFileMonitor *monitor,
 	if (utils_is_ifcfg_alias_file (base, NULL)) {
 		/* Alias file changed. Get the base ifcfg file from it */
 		name = utils_get_ifcfg_from_alias (path);
+		/* But do not signal removing base file if an alias was removed. */
+		if (event_type == G_FILE_MONITOR_EVENT_DELETED)
+			event_type = G_FILE_MONITOR_EVENT_CHANGES_DONE_HINT;
 	} else {
 		/* Given any ifcfg, keys, or routes file, get the ifcfg file path */
 		name = utils_get_ifcfg_path (path);
-- 
2.1.0

